# –ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
name: Flutter CI/CD

# –°–æ–±—ã—Ç–∏—è, –ø—Ä–∏ –∫–æ—Ç–æ—Ä—ã—Ö –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å
on:
  # –ü—Ä–∏ –ø—É—à–µ –≤ –≤–µ—Ç–∫—É dev ffffff
  push:
    branches: [ dev ]

# –ó–∞–¥–∞—á–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Ä–∞–±–æ—á–µ–º –ø—Ä–æ—Ü–µ—Å—Å–µ
jobs:
  # –ó–∞–¥–∞—á–∞ –¥–ª—è —Å–±–æ—Ä–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–ª–∞—Ç—Ç–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  build:
    # –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∑–∞–¥–∞—á–∞
    runs-on: ubuntu-latest
    # –®–∞–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –∑–∞–¥–∞—á–µ
    steps:
      # –®–∞–≥ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ñ–ª–∞—Ç—Ç–µ—Ä SDK
      - name: Install Flutter SDK
        uses: subosito/flutter-action@v1
        with:
          flutter-version: '3.16.3'
      # –®–∞–≥ –¥–ª—è –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è —Å –∏—Å—Ö–æ–¥–Ω—ã–º –∫–æ–¥–æ–º
      - name: Checkout repository
        uses: actions/checkout@v2
      # –®–∞–≥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –ø—Ä–æ–µ–∫—Ç–∞
      - name: Get dependencies
        run: flutter --disable-analytics pub get && flutter --disable-analytics pub run build_runner build --delete-conflicting-outputs
      # –®–∞–≥ –¥–ª—è —Å–±–æ—Ä–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏
      - name: Build debug apk
        run: flutter --disable-analytics pub get build apk --release
      # –®–∞–≥ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è .apk —Ñ–∞–π–ª–∞ –∫–∞–∫ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞
      - name: Upload apk file
        uses: actions/upload-artifact@v2
        with:
          name: apk-file
          path: build/app/outputs/flutter-apk/app-release.apk
  # –ó–∞–¥–∞—á–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è –∏ .apk —Ñ–∞–π–ª–∞ –≤ —Ç–µ–ª–µ–≥—Ä–∞–º
  notifyTelegram:
    # –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∑–∞–¥–∞—á–∞
    runs-on: ubuntu-latest
    # –£—Å–ª–æ–≤–∏–µ, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∑–∞–¥–∞—á–∞
    if: always()
    # –®–∞–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –∑–∞–¥–∞—á–µ
    needs: build
    steps:
      # –®–∞–≥ –¥–ª—è –≤—ã–≤–æ–¥–∞ —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ –ø–∞–ø–∫–µ build/app/outputs/flutter-apk
      - name: List files
        run: ls -R build/app/outputs/flutter-apk
      # –®–∞–≥ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞
      - name: Download apk file
        uses: actions/download-artifact@v2
        with:
          name: apk-file
      # –®–∞–≥ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ .apk —Ñ–∞–π–ª–∞ –≤ —Ç–µ–ª–µ–≥—Ä–∞–º
      - name: Send message and apk file to Telegram
        uses: appleboy/telegram-action@master
        with:
          # –¢–æ–∫–µ–Ω –±–æ—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ —Ñ–∞–π–ª
          to: ${{ secrets.BOT_TOKEN }}
          # ID —á–∞—Ç–∞, –≤ –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ —Ñ–∞–π–ª
          token: ${{ secrets.CHAT_ID }}
          # –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç–∞—Ç—É—Å —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
          message: |
            üë®üèæ‚Äçüíª Actor: ${{ github.actor }}
            üöÄ Workflow: ${{ github.workflow }}
            üóÇ Repository: ${{ github.repository }}
            üîé Commit: ${{ github.event.head_commit.message }}
            üè∑ Branch: ${{ github.ref }}
            üéØ Event: ${{ github.event_name }}
            ü•á Job: ${{ github.job }}
            üö¶ Status: ${{ job.status }}
            üåê URL: ${{ github.event.repository.url }}
          # –ü—É—Ç—å –∫ .apk —Ñ–∞–π–ª—É, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ —Ç–µ–ª–µ–≥—Ä–∞–º
          document: apk-file/app-release.apk



# # –ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
# name: Flutter CI/CD

# # –°–æ–±—ã—Ç–∏—è, –ø—Ä–∏ –∫–æ—Ç–æ—Ä—ã—Ö –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å
# on:
#   # –ü—Ä–∏ –ø—É—à–µ –≤ –≤–µ—Ç–∫—É dev ffffff
#   push:
#     branches: [ dev ]

# # –ó–∞–¥–∞—á–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Ä–∞–±–æ—á–µ–º –ø—Ä–æ—Ü–µ—Å—Å–µ
# jobs:
#   # –ó–∞–¥–∞—á–∞ –¥–ª—è —Å–±–æ—Ä–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–ª–∞—Ç—Ç–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
#   build:
#     # –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∑–∞–¥–∞—á–∞
#     runs-on: ubuntu-latest
#     # –®–∞–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –∑–∞–¥–∞—á–µ
#     steps:
#       # –®–∞–≥ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ñ–ª–∞—Ç—Ç–µ—Ä SDK
#       - name: Install Flutter SDK
#         uses: subosito/flutter-action@v1
#         with:
#           flutter-version: '3.16.3'
#       # –®–∞–≥ –¥–ª—è –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è —Å –∏—Å—Ö–æ–¥–Ω—ã–º –∫–æ–¥–æ–º
#       - name: Checkout repository
#         uses: actions/checkout@v2
#       # –®–∞–≥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –ø—Ä–æ–µ–∫—Ç–∞
#       - name: Get dependencies
#         run: flutter --disable-analytics pub get
#       # –®–∞–≥ –¥–ª—è —Å–±–æ—Ä–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏
#       - name: Build debug apk
#         run: flutter --disable-analytics pub get build apk --release
#   # –ó–∞–¥–∞—á–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è –≤ —Ç–µ–ª–µ–≥—Ä–∞–º
#   notifyTelegram:
#     # –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∑–∞–¥–∞—á–∞
#     runs-on: ubuntu-latest
#     # –£—Å–ª–æ–≤–∏–µ, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∑–∞–¥–∞—á–∞
#     if: always()
#     # –®–∞–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –∑–∞–¥–∞—á–µ
#     steps:
#       # –®–∞–≥ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ç–µ–ª–µ–≥—Ä–∞–º
#       - name: Send message to Telegram
#         uses: appleboy/telegram-action@master
#         with:
#           # –¢–æ–∫–µ–Ω –±–æ—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
#           to: ${{ secrets.CHAT_ID }}
#           # ID —á–∞—Ç–∞, –≤ –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ
#           token: ${{ secrets.BOT_TOKEN }}
#           # –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç–∞—Ç—É—Å —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
#           format: markdown
#           message: |
#             üë®üèæ‚Äçüíª Actor: ${{ github.actor }}
#             üöÄ Workflow: ${{ github.workflow }}
#             üóÇ Repository: ${{ github.repository }}
#             üîé Commit: ${{ github.event.head_commit.message }}
#             üè∑ Branch: ${{ github.ref }}
#             üéØ Event: ${{ github.event_name }}
#             ü•á Job: ${{ github.job }}
#             üö¶ Status: ${{ job.status }}
#             üåê URL: ${{ github.event.repository.url }}